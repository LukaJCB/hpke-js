<html>
  <head></head>
  <body>
    <script type="module">
      // import { KemId, KdfId, AeadId, CipherSuite } from "https://esm.sh/hpke-js";
      import { KemId, KdfId, AeadId, CipherSuite } from "https://esm.sh/@hpke/core";

      globalThis.doHpke = async () => {

        const suite = new CipherSuite({
          kem: KemId.DhkemP256HkdfSha256,
          kdf: KdfId.HkdfSha256,
          aead: AeadId.Aes128Gcm
        });
 
        const rkp = await suite.generateKeyPair();
      
        // A sender encrypts a message.
        const sender = await suite.createSenderContext({
          recipientPublicKey: rkp.publicKey
        });
        const ct = await sender.seal(new TextEncoder().encode("hello world!"));
      
        // A recipient decripts it.
        const recipient = await suite.createRecipientContext({
          recipientKey: rkp.secretKey,
          enc: sender.enc,
        });
        try {
          const pt = await recipient.open(ct);

          // hello world!
          alert(new TextDecoder().decode(pt));
        } catch (err) {
          alert("failed to decrypt.");
        }
      }
      
    </script>
    <button type="button" onclick="doHpke()">do HPKE</button>
  </body>
</html>
